<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Benchmarks — MetalMom</title>
  <meta name="description" content="MetalMom performance benchmarks — 2-3x faster than librosa on Apple Silicon. Detailed timings, pipeline profiling, and optimization history.">
  <meta property="og:title" content="Benchmarks — MetalMom">
  <meta property="og:description" content="MetalMom performance benchmarks. 2-3x faster than librosa on Apple Silicon.">
  <meta property="og:type" content="website">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#9889;</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500;600&family=Syne:wght@500;600;700;800&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ============================================================
       Navigation
       ============================================================ -->
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <div class="container">
      <a href="index.html" class="nav-logo">MetalMom</a>

      <button class="nav-hamburger" aria-label="Toggle navigation" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <div class="nav-links">
        <a href="getting-started.html">Getting Started</a>
        <a href="migration-librosa.html">Migration</a>
        <a href="tutorials/beat-tracking.html">Tutorials</a>
        <a href="benchmarks.html" class="active">Benchmarks</a>
        <a href="architecture.html">Architecture</a>
        <a href="../api/index.html" class="external">API Reference</a>
        <a href="https://github.com/zakkeown/MetalMom" class="external" target="_blank" rel="noopener">GitHub</a>
      </div>
    </div>
  </nav>

  <!-- ============================================================
       Hero (smaller than homepage)
       ============================================================ -->
  <section class="content-hero">
    <div class="content-hero-inner">
      <h1>Benchmarks</h1>
      <p class="content-subtitle">Mom doesn't skip leg day. Here are the numbers.</p>
    </div>
  </section>

  <!-- ============================================================
       Content
       ============================================================ -->
  <main class="content-page content-page--wide">

    <!-- Test Setup -->
    <section class="content-section" id="test-setup">
      <h2>Test Setup</h2>
      <p><strong>Hardware:</strong> Apple M4 Max (14 CPU cores, ~10 GPU cores), macOS 15, Python 3.14, MetalMom 0.1.0.</p>
      <p><strong>Methodology:</strong> Synthetic 440 Hz sine waves at 44100 Hz. Mean of 5 timed iterations after 1 warmup. All numbers in milliseconds.</p>
    </section>

    <!-- MetalMom vs librosa -->
    <section class="content-section" id="vs-librosa">
      <h2>MetalMom vs librosa</h2>

      <!-- 30-second signal -->
      <h3>30-second signal</h3>
      <div class="content-table-wrapper">
        <table class="content-table">
          <thead>
            <tr>
              <th>Operation</th>
              <th style="text-align: right;">MetalMom (ms)</th>
              <th style="text-align: right;">librosa (ms)</th>
              <th style="text-align: right;">Speedup</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>STFT <code>n_fft=2048</code></td>
              <td style="text-align: right;">7.9</td>
              <td style="text-align: right;">12.7</td>
              <td style="text-align: right;"><span class="speedup-good">1.6x</span></td>
            </tr>
            <tr>
              <td>Mel spectrogram</td>
              <td style="text-align: right;">7.1</td>
              <td style="text-align: right;">19.6</td>
              <td style="text-align: right;"><span class="speedup-fast">2.7x</span></td>
            </tr>
            <tr>
              <td>MFCC</td>
              <td style="text-align: right;">7.3</td>
              <td style="text-align: right;">19.8</td>
              <td style="text-align: right;"><span class="speedup-fast">2.7x</span></td>
            </tr>
            <tr>
              <td>CQT</td>
              <td style="text-align: right;">11.8</td>
              <td style="text-align: right;">27.5</td>
              <td style="text-align: right;"><span class="speedup-fast">2.3x</span></td>
            </tr>
            <tr>
              <td>Onset strength</td>
              <td style="text-align: right;">7.6</td>
              <td style="text-align: right;">20.6</td>
              <td style="text-align: right;"><span class="speedup-fast">2.7x</span></td>
            </tr>
            <tr>
              <td>Beat tracking</td>
              <td style="text-align: right;">8.3</td>
              <td style="text-align: right;">22.6</td>
              <td style="text-align: right;"><span class="speedup-fast">2.7x</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 5-second signal -->
      <h3>5-second signal</h3>
      <div class="content-table-wrapper">
        <table class="content-table">
          <thead>
            <tr>
              <th>Operation</th>
              <th style="text-align: right;">MetalMom (ms)</th>
              <th style="text-align: right;">librosa (ms)</th>
              <th style="text-align: right;">Speedup</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>STFT <code>n_fft=2048</code></td>
              <td style="text-align: right;">3.5</td>
              <td style="text-align: right;">2.3</td>
              <td style="text-align: right;"><span class="speedup-slow">0.6x</span></td>
            </tr>
            <tr>
              <td>Mel spectrogram</td>
              <td style="text-align: right;">1.6</td>
              <td style="text-align: right;">3.9</td>
              <td style="text-align: right;"><span class="speedup-fast">2.5x</span></td>
            </tr>
            <tr>
              <td>MFCC</td>
              <td style="text-align: right;">1.8</td>
              <td style="text-align: right;">4.5</td>
              <td style="text-align: right;"><span class="speedup-fast">2.5x</span></td>
            </tr>
            <tr>
              <td>CQT</td>
              <td style="text-align: right;">8.1</td>
              <td style="text-align: right;">9.9</td>
              <td style="text-align: right;"><span class="speedup-good">1.2x</span></td>
            </tr>
            <tr>
              <td>Onset strength</td>
              <td style="text-align: right;">1.9</td>
              <td style="text-align: right;">4.1</td>
              <td style="text-align: right;"><span class="speedup-fast">2.2x</span></td>
            </tr>
            <tr>
              <td>Beat tracking</td>
              <td style="text-align: right;">1.8</td>
              <td style="text-align: right;">4.2</td>
              <td style="text-align: right;"><span class="speedup-fast">2.4x</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 1-second signal -->
      <h3>1-second signal</h3>
      <div class="content-table-wrapper">
        <table class="content-table">
          <thead>
            <tr>
              <th>Operation</th>
              <th style="text-align: right;">MetalMom (ms)</th>
              <th style="text-align: right;">librosa (ms)</th>
              <th style="text-align: right;">Speedup</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>STFT <code>n_fft=2048</code></td>
              <td style="text-align: right;">4.9</td>
              <td style="text-align: right;">0.6</td>
              <td style="text-align: right;"><span class="speedup-slow">0.1x</span></td>
            </tr>
            <tr>
              <td>Mel spectrogram</td>
              <td style="text-align: right;">0.9</td>
              <td style="text-align: right;">1.4</td>
              <td style="text-align: right;"><span class="speedup-good">1.6x</span></td>
            </tr>
            <tr>
              <td>MFCC</td>
              <td style="text-align: right;">1.0</td>
              <td style="text-align: right;">1.4</td>
              <td style="text-align: right;"><span class="speedup-good">1.4x</span></td>
            </tr>
            <tr>
              <td>CQT</td>
              <td style="text-align: right;">7.6</td>
              <td style="text-align: right;">7.8</td>
              <td style="text-align: right;"><span class="speedup-good">1.0x</span></td>
            </tr>
            <tr>
              <td>Onset strength</td>
              <td style="text-align: right;">0.8</td>
              <td style="text-align: right;">1.4</td>
              <td style="text-align: right;"><span class="speedup-good">1.7x</span></td>
            </tr>
            <tr>
              <td>Beat tracking</td>
              <td style="text-align: right;">1.1</td>
              <td style="text-align: right;">1.6</td>
              <td style="text-align: right;"><span class="speedup-good">1.5x</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="content-note">
        On very short signals (1s), the cffi bridge + Swift runtime overhead dominates. This crossover disappears above ~5 seconds. Mom's advantage grows with signal length &mdash; and she's got stamina.
      </div>
    </section>

    <!-- Full Pipeline -->
    <section class="content-section" id="full-pipeline">
      <h2>Full Pipeline (Real Audio)</h2>
      <p>Full analysis pipeline: Load &rarr; STFT &rarr; Mel &rarr; MFCC &rarr; Chroma &rarr; Onset &rarr; Beat tracking.</p>

      <h3>~11-minute song (14.8M samples at 22050 Hz)</h3>
      <div class="content-table-wrapper">
        <table class="content-table">
          <thead>
            <tr>
              <th>Step</th>
              <th style="text-align: right;">Time (ms)</th>
              <th style="text-align: right;">% of Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Load (AAC decode + resample)</td>
              <td style="text-align: right;">637</td>
              <td style="text-align: right;">47.8%</td>
            </tr>
            <tr>
              <td>STFT <code>n_fft=2048, hop=512</code></td>
              <td style="text-align: right;">139</td>
              <td style="text-align: right;">10.4%</td>
            </tr>
            <tr>
              <td>Mel spectrogram (128 bands)</td>
              <td style="text-align: right;">136</td>
              <td style="text-align: right;">10.2%</td>
            </tr>
            <tr>
              <td>MFCC (20 coefficients)</td>
              <td style="text-align: right;">63</td>
              <td style="text-align: right;">4.7%</td>
            </tr>
            <tr>
              <td>Chroma (12 bins)</td>
              <td style="text-align: right;">81</td>
              <td style="text-align: right;">6.1%</td>
            </tr>
            <tr>
              <td>Onset strength</td>
              <td style="text-align: right;">142</td>
              <td style="text-align: right;">10.7%</td>
            </tr>
            <tr>
              <td>Beat tracking (Ellis DP)</td>
              <td style="text-align: right;">136</td>
              <td style="text-align: right;">10.2%</td>
            </tr>
            <tr class="table-total-row">
              <td><strong>Total</strong></td>
              <td style="text-align: right;"><strong>1,333</strong></td>
              <td style="text-align: right;"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="mom-quote">11 minutes of audio, fully analyzed in 1.3 seconds. Mom's fast.</p>

      <p><strong>30-second excerpt:</strong> Total pipeline time: <strong>156ms</strong>.</p>
    </section>

    <!-- Optimization History -->
    <section class="content-section" id="optimization-history">
      <h2>Optimization History</h2>
      <p>Three fixes reduced total time by <strong>7.6x</strong> on full songs.</p>

      <h3>Fix 1: Audio Loading (13x faster)</h3>
      <p><strong>Before:</strong> Manual per-sample linear interpolation.</p>
      <p><strong>After:</strong> <code>AVAudioConverter</code> &mdash; hardware-accelerated resampling.</p>

      <h3>Fix 2: Autocorrelation (O(n&sup2;) &rarr; O(n log n))</h3>
      <p><strong>Before:</strong> Nested loops.</p>
      <p><strong>After:</strong> FFT-based autocorrelation via <code>vDSP</code>.</p>

      <h3>Fix 3: Beat Tracker DP</h3>
      <p><strong>Before:</strong> <code>log()</code> called per iteration (~635K calls).</p>
      <p><strong>After:</strong> Precomputed log lookup table.</p>

      <h3>Before / After</h3>
      <div class="content-table-wrapper">
        <table class="content-table">
          <thead>
            <tr>
              <th>Step</th>
              <th style="text-align: right;">Before (ms)</th>
              <th style="text-align: right;">After (ms)</th>
              <th style="text-align: right;">Speedup</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Load</td>
              <td style="text-align: right;">8,502</td>
              <td style="text-align: right;">637</td>
              <td style="text-align: right;"><span class="speedup-fast">13.3x</span></td>
            </tr>
            <tr>
              <td>STFT</td>
              <td style="text-align: right;">107</td>
              <td style="text-align: right;">139</td>
              <td style="text-align: right;"><span class="speedup-slow">&mdash;</span></td>
            </tr>
            <tr>
              <td>Mel spectrogram</td>
              <td style="text-align: right;">189</td>
              <td style="text-align: right;">136</td>
              <td style="text-align: right;"><span class="speedup-good">1.4x</span></td>
            </tr>
            <tr>
              <td>MFCC</td>
              <td style="text-align: right;">180</td>
              <td style="text-align: right;">63</td>
              <td style="text-align: right;"><span class="speedup-fast">2.9x</span></td>
            </tr>
            <tr>
              <td>Chroma</td>
              <td style="text-align: right;">98</td>
              <td style="text-align: right;">81</td>
              <td style="text-align: right;"><span class="speedup-good">1.2x</span></td>
            </tr>
            <tr>
              <td>Onset strength</td>
              <td style="text-align: right;">440</td>
              <td style="text-align: right;">142</td>
              <td style="text-align: right;"><span class="speedup-fast">3.1x</span></td>
            </tr>
            <tr>
              <td>Beat tracking</td>
              <td style="text-align: right;">580</td>
              <td style="text-align: right;">136</td>
              <td style="text-align: right;"><span class="speedup-fast">4.3x</span></td>
            </tr>
            <tr class="table-total-row">
              <td><strong>Total</strong></td>
              <td style="text-align: right;"><strong>10,096</strong></td>
              <td style="text-align: right;"><strong>1,333</strong></td>
              <td style="text-align: right;"><span class="speedup-fast"><strong>7.6x</strong></span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Backend Dispatch -->
    <section class="content-section" id="backend-dispatch">
      <h2>Backend Dispatch</h2>
      <p>Six backends, zero configuration. Smart Dispatch picks the fastest path automatically.</p>

      <div class="content-table-wrapper">
        <table class="content-table">
          <thead>
            <tr>
              <th>Backend</th>
              <th>Used for</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="backend-metal">Metal shaders</span></td>
              <td>Elementwise ops, reductions, 1D convolution (large inputs)</td>
            </tr>
            <tr>
              <td><span class="backend-metal">MPSGraph</span></td>
              <td>FFT/IFFT, fused MFCC pipeline</td>
            </tr>
            <tr>
              <td><span class="backend-metal">MPS</span></td>
              <td>Matrix multiply (mel filterbank)</td>
            </tr>
            <tr>
              <td><span class="backend-coreml">CoreML / ANE</span></td>
              <td>Neural network inference (beat, onset, key, chord, piano)</td>
            </tr>
            <tr>
              <td><span class="backend-accelerate">Accelerate (vDSP)</span></td>
              <td>FFT, windowing, autocorrelation, small inputs</td>
            </tr>
            <tr>
              <td><span class="backend-accelerate">Accelerate (BLAS)</span></td>
              <td>Matrix multiply fallback</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="content-note">
        Small inputs stay on CPU to avoid Metal command buffer overhead. Mom doesn't drive to the corner store.
      </div>
    </section>

    <!-- Reproduce It Yourself -->
    <section class="content-section" id="reproduce">
      <h2>Reproduce It Yourself</h2>
      <p>Run the benchmarks on your own machine. Requires macOS 14+ with Apple Silicon GPU.</p>

      <div class="content-code-block code-block">
        <div class="code-block-header">
          <span class="code-block-label">Terminal</span>
          <button class="code-block-copy" aria-label="Copy code">Copy</button>
        </div>
        <pre><code><span class="cm"># Build the dylib</span>
<span class="var">swift build -c release && ./scripts/build_dylib.sh</span>

<span class="cm"># Run benchmarks</span>
<span class="var">.venv/bin/python benchmarks/run_benchmarks.py</span>

<span class="cm"># Compare against a previous run</span>
<span class="var">.venv/bin/python benchmarks/run_benchmarks.py --compare benchmarks/results/bench_YYYYMMDD_HHMMSS.json</span></code></pre>
      </div>

      <div class="content-code-block code-block">
        <div class="code-block-header">
          <span class="code-block-label">Terminal</span>
          <button class="code-block-copy" aria-label="Copy code">Copy</button>
        </div>
        <pre><code><span class="cm"># Pipeline profiling (real audio)</span>
<span class="var">swift build -c release</span>
<span class="var">swift run -c release ProfilingRunner /path/to/audio.m4a</span></code></pre>
      </div>

      <p class="content-closing">Go time your code. Mom will wait.</p>
    </section>

  </main>

  <!-- ============================================================
       Footer
       ============================================================ -->
  <footer class="footer">
    <div class="container">
      <div class="footer-links">
        <a href="https://github.com/zakkeown/MetalMom" target="_blank" rel="noopener">GitHub</a>
        <a href="../api/index.html">API Reference</a>
        <a href="https://github.com/zakkeown/MetalMom/blob/main/LICENSE" target="_blank" rel="noopener">License</a>
      </div>
      <div class="footer-meta">
        <p class="footer-tagline">Forged in Metal. Raised by Mom.</p>
        <p class="footer-copyright">&copy; 2026 MetalMom contributors</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/main.js"></script>
</body>
</html>
